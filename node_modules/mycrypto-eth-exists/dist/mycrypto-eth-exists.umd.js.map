{"version":3,"file":"mycrypto-eth-exists.umd.js","sources":["../src/utils/make-request.ts","../src/index.ts"],"sourcesContent":["import axios, { AxiosResponse } from 'axios';\nimport WebSocket from 'isomorphic-ws';\n\nexport interface IHttpConfig {\n  type: 'http';\n  addr: string;\n  port: number;\n  timeout: number;\n}\n\nexport function makeHttpRequest(\n  config: IHttpConfig,\n): Promise<AxiosResponse<any>> {\n  return axios\n    .post(\n      `${config.addr}:${config.port}`,\n      '{\"jsonrpc\":\"2.0\",\"method\":\"net_version\",\"params\":[],\"id\":67}',\n      {\n        headers: {\n          'Content-Type': 'application/json;charset=UTF-8',\n          'Access-Control-Allow-Origin': '*',\n        },\n        timeout: config.timeout,\n      },\n    )\n    .then(r => {\n      if (r.status !== 200) {\n        throw Error('Request failed');\n      }\n      return r;\n    });\n}\n\nexport interface IWSConfig {\n  type: 'ws';\n  addr: string;\n  port: number;\n  timeout: number;\n}\n\nexport function makeWsRequest(config: IWSConfig) {\n  const url = `${config.addr}:${config.port}`;\n  console.log(url);\n  const socket = new WebSocket(url, {\n    handshakeTimeout: config.timeout,\n  });\n  return new Promise((resolve, reject) => {\n    let timeout: NodeJS.Timer;\n    socket.onopen = () => {\n      clearTimeout(timeout);\n      resolve('worked');\n    };\n\n    socket.onerror = e => {\n      clearTimeout(timeout);\n      reject(e);\n    };\n\n    timeout = setTimeout(() => {\n      reject(Error('timeout'));\n    }, config.timeout);\n  });\n}\n\nexport type RequestConfig = IWSConfig | IHttpConfig;\nexport function makeRequest(config: RequestConfig) {\n  switch (config.type) {\n    case 'http':\n      return makeHttpRequest(config);\n    case 'ws':\n      return makeWsRequest(config);\n  }\n}\n","import {\n  IHttpConfig,\n  IWSConfig,\n  makeRequest,\n  RequestConfig,\n} from './utils/make-request';\n\nconst DEFAULT_WS: IWSConfig = {\n  type: 'ws',\n  addr: 'ws://localhost',\n  port: 8546,\n  timeout: 5000,\n};\n\nconst DEFAULT_HTTP: IHttpConfig = {\n  type: 'http',\n  addr: 'http://localhost',\n  port: 8545,\n  timeout: 5000,\n};\n\nconst DEFAULT_CONFIGS = [DEFAULT_HTTP, DEFAULT_WS];\n\nexport type SuccessConfig = RequestConfig & {\n  success: true;\n};\n\nexport type FailConfig = RequestConfig & {\n  success: false;\n  error: Error;\n};\n\nexport interface IOptions {\n  includeDefaults: boolean;\n}\n\nexport function exists(\n  configs: RequestConfig[] = [],\n  opts: IOptions = { includeDefaults: true },\n) {\n  const configsToCheck = [\n    ...configs,\n    ...(opts.includeDefaults ? DEFAULT_CONFIGS : []),\n  ];\n  const result: Promise<(SuccessConfig | FailConfig)[]> = Promise.all(\n    configsToCheck.map(c =>\n      makeRequest(c)\n        .then(() => ({ ...c, success: true as true }))\n        .catch(e => ({ ...c, success: false as false, error: e as Error })),\n    ),\n  );\n\n  return result;\n}\n"],"names":[],"mappings":";;;;;;;;;2BAWE,MAAmB;MAEnB,OAAO,KAAK;WACT,IAAI,CACH,GAAG,MAAM,CAAC,IAAI,IAAI,MAAM,CAAC,IAAI,EAAE,EAC/B,8DAA8D,EAC9D;UACE,OAAO,EAAE;cACP,cAAc,EAAE,gCAAgC;cAChD,6BAA6B,EAAE,GAAG;WACnC;UACD,OAAO,EAAE,MAAM,CAAC,OAAO;OACxB,CACF;WACA,IAAI,CAAC,CAAC;UACL,IAAI,CAAC,CAAC,MAAM,KAAK,GAAG,EAAE;cACpB,MAAM,KAAK,CAAC,gBAAgB,CAAC,CAAC;WAC/B;UACD,OAAO,CAAC,CAAC;OACV,CAAC,CAAC;EACP,CAAC;AASD,yBAA8B,MAAiB;MAC7C,MAAM,GAAG,GAAG,GAAG,MAAM,CAAC,IAAI,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC;MAC5C,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;MACjB,MAAM,MAAM,GAAG,IAAI,SAAS,CAAC,GAAG,EAAE;UAChC,gBAAgB,EAAE,MAAM,CAAC,OAAO;OACjC,CAAC,CAAC;MACH,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM;UACjC,IAAI,OAAqB,CAAC;UAC1B,MAAM,CAAC,MAAM,GAAG;cACd,YAAY,CAAC,OAAO,CAAC,CAAC;cACtB,OAAO,CAAC,QAAQ,CAAC,CAAC;WACnB,CAAC;UAEF,MAAM,CAAC,OAAO,GAAG,CAAC;cAChB,YAAY,CAAC,OAAO,CAAC,CAAC;cACtB,MAAM,CAAC,CAAC,CAAC,CAAC;WACX,CAAC;UAEF,OAAO,GAAG,UAAU,CAAC;cACnB,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;WAC1B,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;OACpB,CAAC,CAAC;EACL,CAAC;AAGD,uBAA4B,MAAqB;MAC/C,QAAQ,MAAM,CAAC,IAAI;UACjB,KAAK,MAAM;cACT,OAAO,eAAe,CAAC,MAAM,CAAC,CAAC;UACjC,KAAK,IAAI;cACP,OAAO,aAAa,CAAC,MAAM,CAAC,CAAC;OAChC;EACH,CAAC;;ECjED,MAAM,UAAU,GAAc;MAC5B,IAAI,EAAE,IAAI;MACV,IAAI,EAAE,gBAAgB;MACtB,IAAI,EAAE,IAAI;MACV,OAAO,EAAE,IAAI;GACd,CAAC;EAEF,MAAM,YAAY,GAAgB;MAChC,IAAI,EAAE,MAAM;MACZ,IAAI,EAAE,kBAAkB;MACxB,IAAI,EAAE,IAAI;MACV,OAAO,EAAE,IAAI;GACd,CAAC;EAEF,MAAM,eAAe,GAAG,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;AAenD,kBACE,UAA2B,EAAE,EAC7B,OAAiB,EAAE,eAAe,EAAE,IAAI,EAAE;MAE1C,MAAM,cAAc,GAAG;UACrB,GAAG,OAAO;UACV,IAAI,IAAI,CAAC,eAAe,GAAG,eAAe,GAAG,EAAE,CAAC;OACjD,CAAC;MACF,MAAM,MAAM,GAA4C,OAAO,CAAC,GAAG,CACjE,cAAc,CAAC,GAAG,CAAC,CAAC,IAClB,WAAW,CAAC,CAAC,CAAC;WACX,IAAI,CAAC,yBAAY,CAAC,IAAE,OAAO,EAAE,IAAY,IAAG,CAAC;WAC7C,KAAK,CAAC,CAAC,uBAAU,CAAC,IAAE,OAAO,EAAE,KAAc,EAAE,KAAK,EAAE,CAAU,IAAG,CAAC,CACtE,CACF,CAAC;MAEF,OAAO,MAAM,CAAC;EAChB,CAAC;;;;;;;;;;;;"}