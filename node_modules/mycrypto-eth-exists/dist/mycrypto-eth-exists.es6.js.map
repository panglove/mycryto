{"version":3,"file":"mycrypto-eth-exists.es6.js","sources":["../src/utils/make-request.ts","../src/index.ts"],"sourcesContent":["import axios, { AxiosResponse } from 'axios';\nimport WebSocket from 'isomorphic-ws';\n\nexport interface IHttpConfig {\n  type: 'http';\n  addr: string;\n  port: number;\n  timeout: number;\n}\n\nexport function makeHttpRequest(\n  config: IHttpConfig,\n): Promise<AxiosResponse<any>> {\n  return axios\n    .post(\n      `${config.addr}:${config.port}`,\n      '{\"jsonrpc\":\"2.0\",\"method\":\"net_version\",\"params\":[],\"id\":67}',\n      {\n        headers: {\n          'Content-Type': 'application/json;charset=UTF-8',\n          'Access-Control-Allow-Origin': '*',\n        },\n        timeout: config.timeout,\n      },\n    )\n    .then(r => {\n      if (r.status !== 200) {\n        throw Error('Request failed');\n      }\n      return r;\n    });\n}\n\nexport interface IWSConfig {\n  type: 'ws';\n  addr: string;\n  port: number;\n  timeout: number;\n}\n\nexport function makeWsRequest(config: IWSConfig) {\n  const url = `${config.addr}:${config.port}`;\n  console.log(url);\n  const socket = new WebSocket(url, {\n    handshakeTimeout: config.timeout,\n  });\n  return new Promise((resolve, reject) => {\n    let timeout: NodeJS.Timer;\n    socket.onopen = () => {\n      clearTimeout(timeout);\n      resolve('worked');\n    };\n\n    socket.onerror = e => {\n      clearTimeout(timeout);\n      reject(e);\n    };\n\n    timeout = setTimeout(() => {\n      reject(Error('timeout'));\n    }, config.timeout);\n  });\n}\n\nexport type RequestConfig = IWSConfig | IHttpConfig;\nexport function makeRequest(config: RequestConfig) {\n  switch (config.type) {\n    case 'http':\n      return makeHttpRequest(config);\n    case 'ws':\n      return makeWsRequest(config);\n  }\n}\n","import {\n  IHttpConfig,\n  IWSConfig,\n  makeRequest,\n  RequestConfig,\n} from './utils/make-request';\n\nconst DEFAULT_WS: IWSConfig = {\n  type: 'ws',\n  addr: 'ws://localhost',\n  port: 8546,\n  timeout: 5000,\n};\n\nconst DEFAULT_HTTP: IHttpConfig = {\n  type: 'http',\n  addr: 'http://localhost',\n  port: 8545,\n  timeout: 5000,\n};\n\nconst DEFAULT_CONFIGS = [DEFAULT_HTTP, DEFAULT_WS];\n\nexport type SuccessConfig = RequestConfig & {\n  success: true;\n};\n\nexport type FailConfig = RequestConfig & {\n  success: false;\n  error: Error;\n};\n\nexport interface IOptions {\n  includeDefaults: boolean;\n}\n\nexport function exists(\n  configs: RequestConfig[] = [],\n  opts: IOptions = { includeDefaults: true },\n) {\n  const configsToCheck = [\n    ...configs,\n    ...(opts.includeDefaults ? DEFAULT_CONFIGS : []),\n  ];\n  const result: Promise<(SuccessConfig | FailConfig)[]> = Promise.all(\n    configsToCheck.map(c =>\n      makeRequest(c)\n        .then(() => ({ ...c, success: true as true }))\n        .catch(e => ({ ...c, success: false as false, error: e as Error })),\n    ),\n  );\n\n  return result;\n}\n"],"names":[],"mappings":";;;yBAWE,MAAmB;IAEnB,OAAO,KAAK;SACT,IAAI,CACH,GAAG,MAAM,CAAC,IAAI,IAAI,MAAM,CAAC,IAAI,EAAE,EAC/B,8DAA8D,EAC9D;QACE,OAAO,EAAE;YACP,cAAc,EAAE,gCAAgC;YAChD,6BAA6B,EAAE,GAAG;SACnC;QACD,OAAO,EAAE,MAAM,CAAC,OAAO;KACxB,CACF;SACA,IAAI,CAAC,CAAC;QACL,IAAI,CAAC,CAAC,MAAM,KAAK,GAAG,EAAE;YACpB,MAAM,KAAK,CAAC,gBAAgB,CAAC,CAAC;SAC/B;QACD,OAAO,CAAC,CAAC;KACV,CAAC,CAAC;CACN;AASD,uBAA8B,MAAiB;IAC7C,MAAM,GAAG,GAAG,GAAG,MAAM,CAAC,IAAI,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC;IAC5C,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACjB,MAAM,MAAM,GAAG,IAAI,SAAS,CAAC,GAAG,EAAE;QAChC,gBAAgB,EAAE,MAAM,CAAC,OAAO;KACjC,CAAC,CAAC;IACH,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM;QACjC,IAAI,OAAqB,CAAC;QAC1B,MAAM,CAAC,MAAM,GAAG;YACd,YAAY,CAAC,OAAO,CAAC,CAAC;YACtB,OAAO,CAAC,QAAQ,CAAC,CAAC;SACnB,CAAC;QAEF,MAAM,CAAC,OAAO,GAAG,CAAC;YAChB,YAAY,CAAC,OAAO,CAAC,CAAC;YACtB,MAAM,CAAC,CAAC,CAAC,CAAC;SACX,CAAC;QAEF,OAAO,GAAG,UAAU,CAAC;YACnB,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;SAC1B,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;KACpB,CAAC,CAAC;CACJ;AAGD,qBAA4B,MAAqB;IAC/C,QAAQ,MAAM,CAAC,IAAI;QACjB,KAAK,MAAM;YACT,OAAO,eAAe,CAAC,MAAM,CAAC,CAAC;QACjC,KAAK,IAAI;YACP,OAAO,aAAa,CAAC,MAAM,CAAC,CAAC;KAChC;CACF;;ACjED,MAAM,UAAU,GAAc;IAC5B,IAAI,EAAE,IAAI;IACV,IAAI,EAAE,gBAAgB;IACtB,IAAI,EAAE,IAAI;IACV,OAAO,EAAE,IAAI;CACd,CAAC;AAEF,MAAM,YAAY,GAAgB;IAChC,IAAI,EAAE,MAAM;IACZ,IAAI,EAAE,kBAAkB;IACxB,IAAI,EAAE,IAAI;IACV,OAAO,EAAE,IAAI;CACd,CAAC;AAEF,MAAM,eAAe,GAAG,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;AAenD,gBACE,UAA2B,EAAE,EAC7B,OAAiB,EAAE,eAAe,EAAE,IAAI,EAAE;IAE1C,MAAM,cAAc,GAAG;QACrB,GAAG,OAAO;QACV,IAAI,IAAI,CAAC,eAAe,GAAG,eAAe,GAAG,EAAE,CAAC;KACjD,CAAC;IACF,MAAM,MAAM,GAA4C,OAAO,CAAC,GAAG,CACjE,cAAc,CAAC,GAAG,CAAC,CAAC,IAClB,WAAW,CAAC,CAAC,CAAC;SACX,IAAI,CAAC,yBAAY,CAAC,IAAE,OAAO,EAAE,IAAY,IAAG,CAAC;SAC7C,KAAK,CAAC,CAAC,uBAAU,CAAC,IAAE,OAAO,EAAE,KAAc,EAAE,KAAK,EAAE,CAAU,IAAG,CAAC,CACtE,CACF,CAAC;IAEF,OAAO,MAAM,CAAC;CACf;;;;"}